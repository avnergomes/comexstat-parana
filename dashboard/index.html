<!DOCTYPE html>
<html lang="pt-BR">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="icon" type="image/svg+xml" href="/comexstat-parana/favicon.svg" />

    <!-- SEO Meta Tags -->
    <title>ComexStat Parana - Comercio Exterior Agricola | Dashboard de Exportacoes e Importacoes</title>
    <meta name="description" content="Dashboard interativo do comercio exterior agricola do Parana. Visualize exportacoes e importacoes de soja, carnes, milho e outros produtos agricolas por pais, periodo e categoria. Dados oficiais do MDIC/ComexStat de 2020 a 2025." />
    <meta name="robots" content="index,follow" />
    <meta name="keywords" content="comercio exterior Parana, exportacao agricola, importacao agropecuaria, balanca comercial, soja, frango, milho, ComexStat, MDIC, dashboard agronegocio, BI agricola, Brazil agricultural exports, Parana trade data, soybean exports dashboard, comercio exterior agricola Brasil, exportaciones Parana" />
    <meta name="author" content="Avner Gomes" />
    <meta name="geo.region" content="BR-PR" />
    <meta name="geo.placename" content="Parana, Brasil" />

    <!-- Canonical URL -->
    <link rel="canonical" href="https://avnergomes.github.io/comexstat-parana/" />

    <!-- Open Graph -->
    <meta property="og:type" content="website" />
    <meta property="og:title" content="ComexStat Parana - Comercio Exterior Agricola" />
    <meta property="og:description" content="Dashboard interativo do comercio exterior agricola do Parana. Exportacoes de US$ 81 bilhoes e importacoes de US$ 10 bilhoes em produtos agricolas." />
    <meta property="og:url" content="https://avnergomes.github.io/comexstat-parana/" />
    <meta property="og:locale" content="pt_BR" />
    <meta property="og:locale:alternate" content="en_US" />
    <meta property="og:locale:alternate" content="es_ES" />
    <meta property="og:site_name" content="ComexStat Parana" />
    <meta property="og:image" content="https://avnergomes.github.io/comexstat-parana/assets/og-image.png" />
    <meta property="og:image:width" content="1200" />
    <meta property="og:image:height" content="630" />

    <!-- Twitter Card -->
    <meta name="twitter:card" content="summary_large_image" />
    <meta name="twitter:title" content="ComexStat Parana - Comercio Exterior Agricola" />
    <meta name="twitter:description" content="Dashboard interativo do comercio exterior agricola do Parana com dados de exportacoes e importacoes." />
    <meta name="twitter:image" content="https://avnergomes.github.io/comexstat-parana/assets/og-image.png" />

    <!-- Structured Data -->
    <script type="application/ld+json">
    {
      "@context": "https://schema.org",
      "@type": "WebApplication",
      "name": "ComexStat Parana",
      "description": "Dashboard interativo do comercio exterior agricola do Parana. Visualize exportacoes e importacoes de produtos agricolas por pais, periodo e categoria.",
      "url": "https://avnergomes.github.io/comexstat-parana/",
      "applicationCategory": "BusinessApplication",
      "operatingSystem": "Web",
      "offers": {
        "@type": "Offer",
        "price": "0",
        "priceCurrency": "BRL"
      },
      "areaServed": {
        "@type": "AdministrativeArea",
        "name": "Parana",
        "addressCountry": "BR"
      },
      "author": {
        "@type": "Person",
        "name": "Avner Gomes",
        "url": "https://avnergomes.github.io/portfolio/"
      },
      "keywords": ["comercio exterior", "exportacao agricola", "importacao", "Parana", "ComexStat", "agronegocio"]
    }
    </script>

    <!-- Preconnect -->
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />

    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=Plus+Jakarta+Sans:wght@500;600;700;800&display=swap" rel="stylesheet" />

    <!-- Leaflet CSS -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY=" crossorigin="" />
  </head>
  <body class="antialiased">
    <div id="root"></div>
    <script type="module" src="/src/main.jsx"></script>

    <!-- Analytics Tracking Script -->
    <script>
    (function() {
      // TODO: Replace with your deployed Google Apps Script URL from google-apps-script-comexstat.gs
      const TRACKING_URL = 'YOUR_GOOGLE_APPS_SCRIPT_URL_HERE';
      const TRACKING_DEBUG = false;

      function getSessionId() {
        let sessionId = sessionStorage.getItem('comex_session_id');
        if (!sessionId) {
          sessionId = 'sess_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9);
          sessionStorage.setItem('comex_session_id', sessionId);
          sessionStorage.setItem('comex_session_start', new Date().toISOString());
          sessionStorage.setItem('comex_page_views', '0');
        }
        return sessionId;
      }

      function isReturningVisitor() {
        const hasVisited = localStorage.getItem('comex_has_visited');
        if (!hasVisited) {
          localStorage.setItem('comex_has_visited', 'true');
          localStorage.setItem('comex_first_visit', new Date().toISOString());
          return false;
        }
        return true;
      }

      function getPerformanceData() {
        const perf = {};
        try {
          const timing = performance.timing || {};
          const navStart = timing.navigationStart || 0;

          perf.loadTime = timing.loadEventEnd ? timing.loadEventEnd - navStart : 0;
          perf.dnsLookupTime = timing.domainLookupEnd - timing.domainLookupStart;
          perf.tcpConnectionTime = timing.connectEnd - timing.connectStart;
          perf.serverResponseTime = timing.responseEnd - timing.requestStart;
          perf.domContentLoadedTime = timing.domContentLoadedEventEnd - navStart;
          perf.domInteractiveTime = timing.domInteractive - navStart;

          const paintEntries = performance.getEntriesByType('paint');
          paintEntries.forEach(entry => {
            if (entry.name === 'first-paint') perf.firstPaint = entry.startTime;
            if (entry.name === 'first-contentful-paint') perf.firstContentfulPaint = entry.startTime;
          });

          const navEntries = performance.getEntriesByType('navigation');
          if (navEntries.length > 0) {
            perf.transferSize = navEntries[0].transferSize;
            perf.encodedBodySize = navEntries[0].encodedBodySize;
            perf.decodedBodySize = navEntries[0].decodedBodySize;
          }
        } catch (e) {}
        return perf;
      }

      function getConnectionInfo() {
        const conn = {};
        try {
          const connection = navigator.connection || navigator.mozConnection || navigator.webkitConnection;
          if (connection) {
            conn.connectionType = connection.effectiveType;
            conn.connectionSpeed = connection.downlink;
            conn.saveDataMode = connection.saveData;
            conn.connectionRTT = connection.rtt;
            conn.connectionDownlinkMax = connection.downlinkMax;
          }
        } catch (e) {}
        return conn;
      }

      function getDeviceInfo() {
        const isMobile = /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);
        const isTablet = /iPad|Android(?!.*Mobile)/i.test(navigator.userAgent);

        return {
          isMobile: isMobile && !isTablet,
          isTablet: isTablet,
          isDesktop: !isMobile && !isTablet,
          touchSupport: 'ontouchstart' in window || navigator.maxTouchPoints > 0,
          maxTouchPoints: navigator.maxTouchPoints || 0,
          cpuCores: navigator.hardwareConcurrency || 0,
          deviceMemory: navigator.deviceMemory || 0,
          screenOrientation: screen.orientation ? screen.orientation.type : 'unknown'
        };
      }

      function getUTMParams() {
        const params = new URLSearchParams(window.location.search);
        return {
          utmSource: params.get('utm_source') || '',
          utmMedium: params.get('utm_medium') || '',
          utmCampaign: params.get('utm_campaign') || '',
          utmTerm: params.get('utm_term') || '',
          utmContent: params.get('utm_content') || ''
        };
      }

      function getUserPreferences() {
        return {
          prefersColorScheme: window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' :
                             window.matchMedia('(prefers-color-scheme: light)').matches ? 'light' : 'no-preference',
          prefersReducedMotion: window.matchMedia('(prefers-reduced-motion: reduce)').matches,
          displayMode: window.matchMedia('(display-mode: standalone)').matches ? 'standalone' :
                      window.matchMedia('(display-mode: fullscreen)').matches ? 'fullscreen' : 'browser'
        };
      }

      function trackVisit() {
        const pageViews = parseInt(sessionStorage.getItem('comex_page_views') || '0') + 1;
        sessionStorage.setItem('comex_page_views', pageViews.toString());

        const visitData = {
          // Session
          sessionId: getSessionId(),
          timestamp: new Date().toISOString(),
          returningVisitor: isReturningVisitor(),
          sessionStartTime: sessionStorage.getItem('comex_session_start'),
          pageViewsInSession: pageViews,

          // Page
          origin: window.location.origin,
          page: window.location.href,
          pathname: window.location.pathname,
          queryString: window.location.search,
          referrer: document.referrer,
          pageTitle: document.title,

          // Browser
          userAgent: navigator.userAgent,
          language: navigator.language,
          languages: navigator.languages ? navigator.languages.join(',') : navigator.language,
          platform: navigator.platform,
          vendor: navigator.vendor,
          cookiesEnabled: navigator.cookieEnabled,
          doNotTrack: navigator.doNotTrack,
          onlineStatus: navigator.onLine,

          // Screen
          screenWidth: screen.width,
          screenHeight: screen.height,
          availScreenWidth: screen.availWidth,
          availScreenHeight: screen.availHeight,
          colorDepth: screen.colorDepth,
          pixelRatio: window.devicePixelRatio,
          viewportWidth: window.innerWidth,
          viewportHeight: window.innerHeight,

          // Timezone
          timezone: Intl.DateTimeFormat().resolvedOptions().timeZone,
          timezoneOffset: new Date().getTimezoneOffset(),

          // Context
          historyLength: history.length,
          isIframe: window.self !== window.top,
          secureContext: window.isSecureContext,

          // Device & Connection
          ...getDeviceInfo(),
          ...getConnectionInfo(),
          ...getPerformanceData(),
          ...getUTMParams(),
          ...getUserPreferences()
        };

        if (TRACKING_DEBUG) {
          console.log('[ComexStat Tracking]', visitData);
        }

        fetch(TRACKING_URL, {
          method: 'POST',
          mode: 'no-cors',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify(visitData),
          keepalive: true
        }).catch(() => {});
      }

      // Track initial visit
      if (document.readyState === 'complete') {
        trackVisit();
      } else {
        window.addEventListener('load', trackVisit);
      }

      // Track SPA navigation
      window.addEventListener('hashchange', trackVisit);
      window.addEventListener('popstate', function() {
        setTimeout(trackVisit, 100);
      });

      const originalPushState = history.pushState;
      history.pushState = function() {
        originalPushState.apply(this, arguments);
        setTimeout(trackVisit, 100);
      };

      const originalReplaceState = history.replaceState;
      history.replaceState = function() {
        originalReplaceState.apply(this, arguments);
        setTimeout(trackVisit, 100);
      };
    })();
    </script>
  </body>
</html>
